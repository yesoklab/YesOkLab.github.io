<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WRISTORY | Digital Heritage</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Noto+Sans+KR:wght@400;700&display=swap');
    body { font-family: 'Noto Sans KR', sans-serif; background-color: #0F111A; color: #E2E8F0; }
    .serif { font-family: 'Playfair Display', serif; }
    .xmas-banner { background: linear-gradient(90deg, #7f1d1d, #14532d); }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #1e293b; }
    ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const INDEPENDENCE_FIGHTERS = [
      { id: '1', title: 'ë°±ë²” ê¹€êµ¬', img: 'https://cloudflare-ipfs.com/ipfs/bafkreie4kz6obq6hjvwtrn5hi33yptemfch6kkjmwj5h22b7imipxjxd6u' },
      { id: '2', title: 'ì•ˆì¤‘ê·¼', img: 'https://cloudflare-ipfs.com/ipfs/bafkreic4bp2ylmmamglszxxnnbipbqlz535qfrhtlm5sgc72lpssvsi3x4' },
      { id: '3', title: 'ë„ì‚° ì•ˆì°½í˜¸', img: 'https://cloudflare-ipfs.com/ipfs/bafkreig2qpetwuern2nyndlzn4u2z3j752su7pmx7jxrdmwr7man7dfdg4' },
      { id: '4', title: 'ìœ¤ë´‰ê¸¸', img: 'https://cloudflare-ipfs.com/ipfs/bafkreiaayojxjidmtyu6rnqtfwmabestd7qf7aai4klqpjfflqk4pzytde' },
      { id: '5', title: 'ê¹€ë§ˆë¦¬ì•„', img: 'https://cloudflare-ipfs.com/ipfs/bafkreigza7i6mn2jkwbdcy64f5scwji4g6g2fsranp6w4fujn3bf7g3wca' },
      { id: '6', title: 'ìœ ê´€ìˆœ', img: 'https://cloudflare-ipfs.com/ipfs/bafkreiejrnn2dpacgyyexuil5obifqgnfapdgvctsxwm7ne2ny7d6ifh6i' },
    ];

    const App = () => {
      const [view, setView] = useState('HOME');
      const [lang, setLang] = useState('ko');
      const [isMenuOpen, setIsMenuOpen] = useState(false);

      const toggleMenu = () => setIsMenuOpen(!isMenuOpen);

      return (
        <div className="min-h-screen">
          <div className="xmas-banner py-2 text-center text-white text-[11px] font-bold">
            ğŸ„ Merry Christmas! <a href="https://objkt.com/tokens/KT1AQkX48gLHaKSv1NPyrrJFFvZTFsUu9GP8/7" target="_blank" className="underline ml-2">Special NFT â†—</a>
          </div>

          <nav className="sticky top-0 z-50 bg-[#0F111A]/90 backdrop-blur-md border-b border-slate-800 h-20 flex items-center px-6 justify-between">
            <span className="text-xl font-bold serif text-white cursor-pointer" onClick={() => setView('HOME')}>WRISTORY</span>
            
            {/* ë°ìŠ¤í¬íƒ‘ ë©”ë‰´ */}
            <div className="hidden md:flex gap-6 text-sm font-medium items-center text-white">
              <button onClick={() => setView('HOME')} className={view === 'HOME' ? 'text-white' : 'text-slate-400'}>ì»¬ë ‰ì…˜</button>
              <button onClick={() => setView('AI')} className="bg-slate-800 text-purple-300 px-4 py-1 rounded-full border border-slate-600">âœ¨ AI ì§ˆë¬¸</button>
              <button onClick={() => setLang(l => l === 'en' ? 'ko' : 'en')} className="w-8 h-8 rounded-full bg-slate-700 text-[10px]">{lang.toUpperCase()}</button>
            </div>

            {/* ëª¨ë°”ì¼ í–„ë²„ê±° ë²„íŠ¼ */}
            <button className="md:hidden text-white text-2xl" onClick={toggleMenu}>â˜°</button>
          </nav>

          {/* ëª¨ë°”ì¼ ë©”ë‰´ ì˜¤ë²„ë ˆì´ */}
          {isMenuOpen && (
            <div className="md:hidden fixed top-20 left-0 w-full bg-[#0F111A] border-b border-slate-800 p-8 flex flex-col gap-6 z-40 text-center font-bold text-white shadow-2xl">
              <button onClick={() => { setView('HOME'); setIsMenuOpen(false); }}>ì»¬ë ‰ì…˜</button>
              <button onClick={() => { setView('AI'); setIsMenuOpen(false); }} className="text-purple-400">AI ì§ˆë¬¸</button>
              <button onClick={() => { setLang(lang === 'ko' ? 'en' : 'ko'); setIsMenuOpen(false); }}>{lang === 'ko' ? 'ENGLISH' : 'í•œêµ­ì–´'}</button>
            </div>
          )}

          <main className="py-12 px-6 max-w-7xl mx-auto">
            {view === 'HOME' && (
              <div className="space-y-20">
                <div className="text-center"><h1 className="text-4xl md:text-7xl font-bold serif mb-4">History on Your Wrist</h1></div>
                <section>
                  <h2 className="text-2xl font-bold mb-8 text-center serif text-slate-300 italic">Archive I: Independence Fighters</h2>
                  <div className="grid grid-cols-2 md:grid-cols-6 gap-4">
                    {INDEPENDENCE_FIGHTERS.map(col => (
                      <div key={col.id} className="bg-slate-800/40 rounded-xl overflow-hidden border border-slate-700">
                        <img src={col.img} className="h-40 md:h-64 w-full object-cover" />
                        <div className="p-3 text-center text-xs font-bold">{col.title}</div>
                      </div>
                    ))}
                  </div>
                </section>
                {/* ë¹„íŠ¸ì½”ì¸ ë° íŒŒíŠ¸ë„ˆ ì„¹ì…˜ì€ ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ ìœ ì§€ */}
              </div>
            )}
            {view === 'AI' && <AiChat language={lang} />}
          </main>
          <footer className="py-12 text-center text-slate-600 text-[10px]">Â© 2025 YesOkLab | WRISTORY</footer>
        </div>
      );
    };

    const AiChat = ({ language }) => {
      const [msgs, setMsgs] = useState([{ role: 'model', text: language === 'ko' ? 'ì•ˆë…•í•˜ì„¸ìš”! ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”.' : 'Hello! Ask me anything.' }]);
      const [input, setInput] = useState('');
      const [loading, setLoading] = useState(false);
      const scroll = useRef(null);
      useEffect(() => { scroll.current?.scrollIntoView({ behavior: "smooth" }); }, [msgs]);

      const send = async (e) => {
        e.preventDefault(); if (!input.trim() || loading) return;
        const text = input; setInput(''); setMsgs(p => [...p, { role: 'user', text }]); setLoading(true);
        try {
          const res = await fetch(`/.netlify/functions/ask-ai`, {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ userMessage: text, lang: language }) // âœ… lang ê°’ ì „ë‹¬
          });
          const data = await res.json();
          setMsgs(p => [...p, { role: 'model', text: data.reply }]);
        } catch { setMsgs(p => [...p, { role: 'model', text: "Connection error." }]); } finally { setLoading(false); }
      };

      return (
        <div className="max-w-3xl mx-auto h-[60vh] bg-slate-800/80 rounded-3xl border border-slate-700 flex flex-col overflow-hidden">
          <div className="flex-1 overflow-y-auto p-6 space-y-4">
            {msgs.map((m, i) => (
              <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                <div className={`max-w-[85%] p-4 rounded-2xl ${m.role === 'user' ? 'bg-purple-600' : 'bg-slate-700'} text-white`}>{m.text}</div>
              </div>
            ))}
            <div ref={scroll} />
          </div>
          <form onSubmit={send} className="p-4 bg-slate-900 flex gap-2">
            <input type="text" value={input} onChange={e => setInput(e.target.value)} className="flex-1 bg-slate-800 rounded-xl px-4 py-3 outline-none text-white" placeholder="Message..." />
            <button type="submit" className="bg-purple-600 px-6 py-3 rounded-xl font-bold text-white">Send</button>
          </form>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
